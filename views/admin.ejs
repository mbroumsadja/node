<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="/css/app.css">
    <link rel="shortcut icon" href="/img/Fichier 4.svg" type="image/x-icon">
    <title>Schedule - Gestion des Séances</title>
    <style>
        .seances-list {
    display: flex;
    flex-direction: column;
    gap: 16px;
    margin-bottom: 60px;
}

.seance-item {
    background-color: var(--card-bg);
    border-radius: var(--border-radius);
    padding: 16px;
    box-shadow: var(--shadow-sm);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.seance-info {
    flex: 1;
}

.seance-actions button {
    background: var(--primary-color);
    color: white;
    border: none;
    padding: 8px 12px;
    margin-left: 8px;
    border-radius: 5px;
    cursor: pointer;
    transition: background 0.2s;
}

.seance-actions button:hover {
    background: var(--primary-dark);
}

.add-btn {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: var(--primary-color);
    color: white;
    border: none;
    padding: 12px;
    border-radius: 50%;
    font-size: 1.5rem;
    box-shadow: var(--shadow-md);
    cursor: pointer;
}

.add-btn:hover {
    background: var(--primary-dark);
}

/* Modal */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    justify-content: center;
    align-items: center;
    z-index: 200;
}

.modal-content {
    background: var(--card-bg);
    padding: 20px;
    border-radius: var(--border-radius);
    width: 90%;
    max-width: 400px;
    box-shadow: var(--shadow-md);
}

.modal-content h2 {
    margin-bottom: 20px;
    color: var(--text-primary);
}

.form-group {
    margin-bottom: 16px;
}

.form-group label {
    display: block;
    margin-bottom: 4px;
    color: var(--text-secondary);
}

.form-group input, .form-group select {
    width: 100%;
    padding: 8px;
    border: 1px solid var(--text-secondary);
    border-radius: 5px;
    font-size: 1rem;
}

.modal-actions {
    display: flex;
    gap: 10px;
    justify-content: flex-end;
}

.save-btn {
    background: var(--primary-color);
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 5px;
    cursor: pointer;
}

.cancel-btn {
    background: var(--accent-color);
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 5px;
    cursor: pointer;
}
    </style>
</head>
<body>
    <header>
        <button type="button" id="back-btn"><i class="fas fa-arrow-left"></i></button>
        <div class="header-title">Gestion des Séances</div>
        <button type="button" id="logout-btn"><i class="fas fa-sign-out-alt"></i></button>
    </header>

    <div class="container">
        <div class="search-container">
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" placeholder="Rechercher une séance..." id="searchInput">
            </div>
        </div>

        <div id="seances-list" class="seances-list">
            <!-- Les séances seront générées dynamiquement ici -->
        </div>

        <button class="add-btn" id="add-seance-btn"><i class="fas fa-plus"></i> Ajouter une séance</button>
    </div>

    <!-- Modal pour créer/éditer une séance -->
    <div class="modal" id="seance-modal">
        <div class="modal-content">
            <h2 id="modal-title">Nouvelle Séance</h2>
            <form id="seance-form">
                <div class="form-group">
                    <label for="course">Cours</label>
                    <input type="text" id="course" name="course" required>
                </div>
                <div class="form-group">
                    <label for="professor">Professeur</label>
                    <input type="text" id="professor" name="professor" required>
                </div>
                <div class="form-group">
                    <label for="location">Lieu</label>
                    <input type="text" id="location" name="location" required>
                </div>
                <div class="form-group">
                    <label for="date">Date (JJ/MM/AAAA)</label>
                    <input type="text" id="date" name="date" placeholder="ex: 01/04/2025" required>
                </div>
                <div class="form-group">
                    <label for="startTime">Heure de début</label>
                    <input type="text" id="startTime" name="startTime" placeholder="ex: 7h30" required>
                </div>
                <div class="form-group">
                    <label for="endTime">Heure de fin</label>
                    <input type="text" id="endTime" name="endTime" placeholder="ex: 9h30" required>
                </div>
                <div class="form-group">
                    <label for="type">Type</label>
                    <select id="type" name="type">
                        <option value="analysis">Analyse</option>
                        <option value="algebra">Algèbre</option>
                        <option value="info">Informatique</option>
                    </select>
                </div>
                <input type="hidden" id="seance-id" name="id">
                <div class="modal-actions">
                    <button type="submit" class="save-btn">Enregistrer</button>
                    <button type="button" class="cancel-btn" id="cancel-btn">Annuler</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
    const seancesList = document.getElementById('seances-list');
    const searchInput = document.getElementById('searchInput');
    const addSeanceBtn = document.getElementById('add-seance-btn');
    const seanceModal = document.getElementById('seance-modal');
    const seanceForm = document.getElementById('seance-form');
    const cancelBtn = document.getElementById('cancel-btn');
    const modalTitle = document.getElementById('modal-title');
    const logoutBtn = document.getElementById('logout-btn');
    let seancesData = [];
    const username = localStorage.getItem('adminUsername') || 'Admin'; // Récupéré après login/signup

    // Vérifier si l'admin est connecté
    if (!localStorage.getItem('adminToken')) {
        window.location.href = '/login_admin';
        return;
    }

    // Récupérer les séances depuis l'API (à implémenter côté serveur)
    async function fetchSeances() {
        try {
            const response = await fetch('http://localhost:3001/seances', {
                headers: { 'Authorization': `Bearer ${localStorage.getItem('adminToken')}` }
            });
            const data = await response.json();
            if (data.success) {
                seancesData = data.seances;
                renderSeances(seancesData);
            }
        } catch (error) {
            console.error('Erreur:', error);
            seancesList.innerHTML = '<p>Erreur lors du chargement des séances.</p>';
        }
    }

    // Afficher les séances
    function renderSeances(data) {
        seancesList.innerHTML = '';
        data.forEach(seance => {
            const seanceItem = document.createElement('div');
            seanceItem.className = 'seance-item';
            seanceItem.innerHTML = `
                <div class="seance-info">
                    <strong>${seance.course}</strong> - ${seance.startTime} à ${seance.endTime}<br>
                    ${seance.professor} - ${seance.location} (Créé par: ${username})
                </div>
                <div class="seance-actions">
                    <button onclick="editSeance('${seance.id}')">Éditer</button>
                    <button onclick="deleteSeance('${seance.id}')">Supprimer</button>
                </div>
            `;
            seancesList.appendChild(seanceItem);
        });
    }

    // Recherche
    searchInput.addEventListener('input', () => {
        const searchTerm = searchInput.value.toLowerCase();
        const filteredData = seancesData.filter(seance =>
            seance.course.toLowerCase().includes(searchTerm) ||
            seance.professor.toLowerCase().includes(searchTerm) ||
            seance.location.toLowerCase().includes(searchTerm)
        );
        renderSeances(filteredData);
    });

    // Ouvrir le modal pour ajouter une séance
    addSeanceBtn.addEventListener('click', () => {
        modalTitle.textContent = 'Nouvelle Séance';
        seanceForm.reset();
        seanceModal.style.display = 'flex';
    });

    // Annuler le modal
    cancelBtn.addEventListener('click', () => {
        seanceModal.style.display = 'none';
    });

    // Soumettre le formulaire (créer ou éditer)
    seanceForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const seanceData = {
            course: document.getElementById('course').value,
            professor: document.getElementById('professor').value,
            location: document.getElementById('location').value,
            date: document.getElementById('date').value,
            startTime: document.getElementById('startTime').value,
            endTime: document.getElementById('endTime').value,
            type: document.getElementById('type').value,
            create_by: username // Remplace create_by par le nom de l'utilisateur
        };
        const seanceId = document.getElementById('seance-id').value;

        if (seanceId) {
            // Éditer une séance (à implémenter côté serveur)
            await updateSeance(seanceId, seanceData);
        } else {
            // Créer une nouvelle séance
            await createSeance([seanceData]); // L'API attend un tableau
        }
        seanceModal.style.display = 'none';
        fetchSeances();
    });

    // Créer une séance via l'API
    async function createSeance(data) {
        try {
            const response = await fetch('http://localhost:3001/create_session', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                },
                body: JSON.stringify({ data })
            });
            const result = await response.json();
            if (!result.success) {
                alert(result.message);
            }
        } catch (error) {
            console.error('Erreur:', error);
            alert('Erreur lors de la création de la séance.');
        }
    }

    // Éditer une séance
    window.editSeance = (id) => {
        const seance = seancesData.find(s => s.id === id);
        if (seance) {
            modalTitle.textContent = 'Éditer la Séance';
            document.getElementById('course').value = seance.course;
            document.getElementById('professor').value = seance.professor;
            document.getElementById('location').value = seance.location;
            document.getElementById('date').value = seance.date;
            document.getElementById('startTime').value = seance.startTime;
            document.getElementById('endTime').value = seance.endTime;
            document.getElementById('type').value = seance.type;
            document.getElementById('seance-id').value = seance.id;
            seanceModal.style.display = 'flex';
        }
    };

    // Mettre à jour une séance (à implémenter côté serveur)
    async function updateSeance(id, data) {
        try {
            const response = await fetch(`http://localhost:3001/seance/${id}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                },
                body: JSON.stringify(data)
            });
            const result = await response.json();
            if (!result.success) {
                alert(result.message);
            }
        } catch (error) {
            console.error('Erreur:', error);
            alert('Erreur lors de la mise à jour de la séance.');
        }
    }

    // Supprimer une séance (à implémenter côté serveur)
    window.deleteSeance = async (id) => {
        if (confirm('Voulez-vous vraiment supprimer cette séance ?')) {
            try {
                const response = await fetch(`http://localhost:3001/seance/${id}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${localStorage.getItem('adminToken')}` }
                });
                const result = await response.json();
                if (result.success) {
                    fetchSeances();
                } else {
                    alert(result.message);
                }
            } catch (error) {
                console.error('Erreur:', error);
                alert('Erreur lors de la suppression.');
            }
        }
    };

    // Déconnexion
    logoutBtn.addEventListener('click', () => {
        localStorage.removeItem('adminToken');
        localStorage.removeItem('adminUsername');
        window.location.href = '/login_admin';
    });

    // Initialisation
    fetchSeances();
});
    </script>
</body>
</html>